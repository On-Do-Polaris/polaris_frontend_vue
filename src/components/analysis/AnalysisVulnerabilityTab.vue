<script setup lang="ts">
import { ref, computed } from 'vue';
import { useSitesStore } from '@/store/sites';

interface VulnerabilityFactor {
  name: string;
  value: string;
  level: '높음' | '보통' | '낮음';
  score: number;
}

const sitesStore = useSitesStore();
const siteInfo = computed(() => sitesStore.allSites[4]);

const totalVulnerabilityScore = 70;
const maxScore = 100;

const vulnerabilityFactors = ref<VulnerabilityFactor[]>([
  { name: '이상 고온', value: 'Extreme Heat', level: '높음', score: 85 },
  { name: '물 부족', value: 'Water Stress', level: '높음', score: 72 },
  { name: '폭우 침수', value: 'Pluvial Flood', level: '높음', score: 80 },
  { name: '하천 범람', value: 'Fluvial Flood', level: '보통', score: 55 },
  { name: '해안 홍수', value: 'Coastal Flood', level: '낮음', score: 0 },
  { name: '태풍', value: 'Tropical Cyclone', level: '낮음', score: 30 },
  { name: '산사태', value: 'Landslide', level: '낮음', score: 25 },
  { name: '가뭄', value: 'Drought', level: '낮음', score: 40 },
  { name: '산불', value: 'Wildfire', level: '낮음', score: 20 },
]);

const getLevelColor = (level: '높음' | '보통' | '낮음') => {
  switch (level) {
    case '높음':
      return '#EA002C';
    case '보통':
      return '#FBBC05';
    case '낮음':
      return '#B3CF0A';
  }
};

const getLevelBgColor = (level: '높음' | '보통' | '낮음') => {
  switch (level) {
    case '높음':
      return '#FEE2E2';
    case '보통':
      return '#FEF3C7';
    case '낮음':
      return '#ECFCCB';
  }
};
</script>

<template>
  <div class="mt-6">
    <!-- 종합 취약성 점수 -->
    <div class="bg-white border border-gray-200 shadow-sm mb-6">
      <div class="border-b border-gray-200 px-6 py-3 bg-gray-50">
        <h3 class="text-sm text-gray-900">종합 취약성 점수</h3>
      </div>
      <div class="p-8 flex items-center justify-between">
        <div class="text-sm text-gray-600 flex items-center">
          점수가 높을수록 기후 리스크 취약성이 높습니다
        </div>
        <div class="flex items-center">
          <div class="flex items-baseline gap-2">
            <span class="text-4xl text-[#EA002C]">
              {{ totalVulnerabilityScore }}
            </span>
            <span class="text-2xl text-gray-400">/ {{ maxScore }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 사업장 정보 -->
    <div class="bg-white border border-gray-200 shadow-sm mb-6">
      <div class="border-b border-gray-200 px-6 py-3 bg-gray-50">
        <h3 class="text-sm text-gray-900">사업장 정보</h3>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-2 gap-6">
          <div class="flex items-start gap-3">
            <div class="text-sm text-gray-500 w-24">유형</div>
            <div class="text-sm text-gray-900">{{ siteInfo?.type || '-' }}</div>
          </div>
          <div class="flex items-start gap-3">
            <div class="text-sm text-gray-500 w-24">준공연도</div>
            <div class="text-sm text-gray-900">
              {{ siteInfo?.constructionYear ? `${siteInfo.constructionYear}년` : '-' }}
            </div>
          </div>
          <div class="flex items-start gap-3">
            <div class="text-sm text-gray-500 w-24">건물구조</div>
            <div class="text-sm text-gray-900">
              {{ siteInfo?.buildingStructure || '-' }}
            </div>
          </div>
          <div class="flex items-start gap-3">
            <div class="text-sm text-gray-500 w-24">좌표</div>
            <div class="text-sm text-gray-900">
              {{ siteInfo?.latitude || '-' }} / {{ siteInfo?.longitude || '-' }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 취약성 요인별 분석 -->
    <div class="bg-white border border-gray-200 shadow-sm">
      <div class="border-b border-gray-200 px-6 py-3 bg-gray-50">
        <h3 class="text-sm text-gray-900">취약성 요인별 분석</h3>
      </div>
      <div class="p-6">
        <div class="space-y-4">
          <div
            v-for="(factor, index) in vulnerabilityFactors"
            :key="index"
            class="border-b border-gray-100 pb-4 last:border-b-0 last:pb-0"
          >
            <div class="flex items-center justify-between mb-2">
              <div class="flex items-center gap-3">
                <div class="text-sm text-gray-900 w-32">
                  {{ factor.name }}
                </div>
                <div class="text-sm text-gray-600">{{ factor.value }}</div>
              </div>
              <div
                class="px-3 py-1 text-xs"
                :style="{
                  color: getLevelColor(factor.level),
                  backgroundColor: getLevelBgColor(factor.level),
                }"
              >
                {{ factor.level }}
              </div>
            </div>
            <div class="flex items-center gap-3">
              <div class="flex-1 bg-gray-100 h-2 overflow-hidden">
                <div
                  class="h-full transition-all duration-500"
                  :style="{
                    width: `${factor.score}%`,
                    backgroundColor: getLevelColor(factor.level),
                  }"
                ></div>
              </div>
              <div class="text-xs text-gray-500 w-12 text-right">
                {{ factor.score }}점
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>